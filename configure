#!/bin/sh

usage='Usage: ./configure [option] ...
Use the option "--help" to list the available options.
'

help='Usage: ./configure [option] ...

Available options:

  --compcertdir=DIR           set the directory in which the compcert
                              is installed (coq-compcert by default)

  --help                      show this help
'

while : ; do
    case "$1" in
        --compcertdir=*)
            compcertdir="${1#*=}" ;;
        -copmcertdir|--compcertdir)
            compcertdir="$2" ; shift ;;
        "")
            # End of arguments
            break ;;
        -help|--help)
            echo "$help" ; exit 0 ;;
        -*)
            echo "Unknown option: $1" ; echo "$usage" ; exit 1 ;;
    esac
    shift
done

# generate Makefile.config and _CoqProject
if [ -z ${compcertdir+x} ]
then
    echo "coq-compcert by default"
rm -f Makefile.config
cat > _CoqProject << EOF
INSTALLDEFAULTROOT = compcerttso
-R compcerttso compcerttso
-R jobqueue jobqueue
EOF
else
# cat > Makefile.config << EOF
# COMPCERTDIR := $compcertdir
# EOF
cat > _CoqProject << EOF
INSTALLDEFAULTROOT = compcerttso
-R compcerttso compcerttso
-R jobqueue jobqueue
-R $compcertdir compcert
EOF
echo "The following configuration was saved in _CoqProject"
echo
cat _CoqProject
fi
